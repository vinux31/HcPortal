@model List<HcPortal.Models.IdpItem>

@{
    ViewData["Title"] = "My IDP";
}

<div class="d-flex justify-content-between align-items-end mb-4">
    <div>
        <h2 class="fw-bold text-primary">My Individual Development Plan</h2>
        <div class="d-flex gap-4 mt-2">
            <div>
                <span class="text-muted small d-block">Coachee</span>
                <span class="fw-bold">User (Anda)</span>
            </div>
            <div>
                <span class="text-muted small d-block">Coach</span>
                <span class="fw-bold">Budi Santoso</span>
            </div>
        </div>
    </div>
    
    <div class="text-end">
        <div class="mb-1">
            <span class="badge bg-primary me-2">Progress Proton: 35%</span>
            <span class="fw-bold text-secondary">Penugasan Tahun 2025, Unit 22</span>
        </div>
        <button class="btn btn-sm btn-primary mt-2"><i class="bi bi-plus-lg"></i> Tambah Rencana Baru</button>
    </div>
</div>

<div class="card shadow-sm border-0">
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
                <thead class="bg-light text-secondary small text-uppercase">
                    <tr>
                        <th class="p-3 border-bottom-0" style="width: 15%">Kompetensi</th>
                        <th class="p-3 border-bottom-0" style="width: 15%">Sub Kompetensi</th>
                        <th class="p-3 border-bottom-0" style="width: 20%">Deliverable</th>
                        <th class="p-3 border-bottom-0 text-center" style="width: 10%">Evidence</th>
                        <th class="p-3 border-bottom-0 text-center" style="width: 13%">Sr. Supervisor</th>
                        <th class="p-3 border-bottom-0 text-center" style="width: 13%">Section Head</th>
                        <th class="p-3 border-bottom-0 text-center" style="width: 14%">HC</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model)
                    {
                        <tr>
                            <td class="p-3 fw-bold text-dark">@item.Kompetensi</td>
                            <td class="p-3 text-muted">@item.SubKompetensi</td>
                            <td class="p-3 text-muted">@item.Deliverable</td>
                            
                            <!-- Column Evidence -->
                            <td class="p-3 text-center">
                                @if(item.Evidence != "-" && !string.IsNullOrEmpty(item.Evidence)) {
                                    <button class="btn btn-sm btn-outline-success rounded-pill px-3" data-bs-toggle="tooltip" title="View Evidence">
                                        <i class="bi bi-file-earmark-check me-1"></i> Uploaded
                                    </button>
                                } else {
                                    <button class="btn btn-sm btn-outline-secondary rounded-pill px-3 dashed-border" data-bs-toggle="tooltip" title="Upload Evidence">
                                        <i class="bi bi-upload me-1"></i> Pending
                                    </button>
                                }
                            </td>

                            <!-- Appr Sr. Supervisor -->
                            <td class="p-3 text-center">
                                @{ RenderStatusBadge(item.ApproveSrSpv); }
                            </td>

                            <!-- Appr Section Head -->
                            <td class="p-3 text-center">
                                @{ RenderStatusBadge(item.ApproveSectionHead); }
                            </td>

                            <!-- Appr HC -->
                            <td class="p-3 text-center">
                                @{ RenderStatusBadge(item.ApproveHC); }
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

@functions {
    void RenderStatusBadge(string? status)
    {
        if (status == "Approved")
        {
            <span class="badge bg-success bg-opacity-10 text-success border border-success px-3 py-2 rounded-pill">
                <i class="bi bi-check-circle-fill me-1"></i> Approved
            </span>
        }
        else if (status == "Rejected")
        {
            <span class="badge bg-danger bg-opacity-10 text-danger border border-danger px-3 py-2 rounded-pill">
                <i class="bi bi-x-circle-fill me-1"></i> Rejected
            </span>
        }
        else if (status == "Pending")
        {
             <span class="badge bg-warning bg-opacity-10 text-warning border border-warning px-3 py-2 rounded-pill">
                <i class="bi bi-hourglass-split me-1"></i> Pending
            </span>
        }
        else
        {
            <span class="text-muted small d-block py-2">-</span>
        }
    }
}